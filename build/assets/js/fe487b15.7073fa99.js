"use strict";(globalThis.webpackChunkphysical_ai_book=globalThis.webpackChunkphysical_ai_book||[]).push([[7641],{2034:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"capstone/capstone-architecture","title":"System Architecture Design","description":"Node graph design, Topic/service mapping, Launch organization, Configuration management, Logging and debugging, Testing strategy.","source":"@site/docs/capstone/architecture.mdx","sourceDirName":"capstone","slug":"/capstone/capstone-architecture","permalink":"/Physical-AI-Humanoid-Robotics-Textbook/docs/capstone/capstone-architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/Darakhshan08/Physical-AI-Humanoid-Robotics-Textbook/tree/main/docs/capstone/architecture.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"id":"capstone-architecture","title":"System Architecture Design","sidebar_label":"Architecture Design","sidebar_position":2,"description":"Node graph design, Topic/service mapping, Launch organization, Configuration management, Logging and debugging, Testing strategy.","keywords":["capstone","architecture","ros2","nodes","topics","launch-files"]},"sidebar":"tutorialSidebar","previous":{"title":"Project Overview","permalink":"/Physical-AI-Humanoid-Robotics-Textbook/docs/capstone/capstone-overview"},"next":{"title":"Voice Pipeline","permalink":"/Physical-AI-Humanoid-Robotics-Textbook/docs/capstone/voice-pipeline"}}');var s=i(4848),r=i(8453);const t={id:"capstone-architecture",title:"System Architecture Design",sidebar_label:"Architecture Design",sidebar_position:2,description:"Node graph design, Topic/service mapping, Launch organization, Configuration management, Logging and debugging, Testing strategy.",keywords:["capstone","architecture","ros2","nodes","topics","launch-files"]},c="System Architecture Design",a={},l=[{value:"Node Graph Design",id:"node-graph-design",level:2},{value:"Topic/Service Mapping",id:"topicservice-mapping",level:2},{value:"Key Topics and Message Types:",id:"key-topics-and-message-types",level:3},{value:"Key Actions and Services:",id:"key-actions-and-services",level:3},{value:"Launch Organization",id:"launch-organization",level:2},{value:"Example: Main Capstone Launch File",id:"example-main-capstone-launch-file",level:3},{value:"Configuration Management",id:"configuration-management",level:2},{value:"Logging and Debugging",id:"logging-and-debugging",level:2},{value:"Testing Strategy",id:"testing-strategy",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"system-architecture-design",children:"System Architecture Design"})}),"\n",(0,s.jsx)(n.p,{children:"Designing the system architecture for an autonomous humanoid robot capstone project involves orchestrating multiple ROS 2 nodes, data flows, and configuration elements into a cohesive and functional system. This chapter guides you through the process of designing a robust and scalable architecture, focusing on node graphs, communication patterns, and effective system management."}),"\n",(0,s.jsx)(n.h2,{id:"node-graph-design",children:"Node Graph Design"}),"\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.strong,{children:"node graph"})," visually represents the ROS 2 nodes in your system and their interconnections via topics, services, and actions. For a humanoid robot capable of voice commands, navigation, and manipulation, the node graph can become quite complex."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mermaid",children:"graph TD\r\n    A[Voice Input] --\x3e B(Voice Command Processor Node)\r\n    B --\x3e C(LLM Planner Node)\r\n    C -- High-level Action Plan --\x3e D(Action Primitive Mapper Node)\r\n    D --\x3e E(Navigation Manager Node)\r\n    D --\x3e F(Manipulation Controller Node)\r\n\r\n    G(Sensor Fusion Node) -- Localized Pose --\x3e E\r\n    G -- Object Detections --\x3e F\r\n    H[Raw Sensor Data] --\x3e P(Perception Nodes - VSLAM/Object Detection)\r\n    P --\x3e G\r\n\r\n    E --\x3e M(Low-level Motion Controller)\r\n    F --\x3e M\r\n    M -- Joint Commands --\x3e R(Robot Hardware Interface Node)\r\n    R -- Joint States --\x3e G\r\n\r\n    C -- Conversational Output --\x3e B\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Voice Input"}),": From microphone."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Voice Command Processor Node"}),": Transcribes speech (e.g., using Whisper) and extracts initial intent."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"LLM Planner Node"}),": Takes high-level intent and current robot/environment state to generate action plans."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Action Primitive Mapper Node"}),": Translates LLM's plan into concrete ROS 2 actions/commands."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Navigation Manager Node"}),": Manages global and local navigation (using Nav2)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Manipulation Controller Node"}),": Handles grasping, arm movements, and object placement."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Perception Nodes"}),": Process raw sensor data for VSLAM, object detection."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sensor Fusion Node"}),": Combines data from various sensors (IMU, Odometry, VSLAM, object detection) for a comprehensive understanding of robot state and environment."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Low-level Motion Controller"}),": Executes joint commands from navigation/manipulation."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Robot Hardware Interface Node"}),": Communicates directly with physical robot actuators and reads sensor data."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"topicservice-mapping",children:"Topic/Service Mapping"}),"\n",(0,s.jsx)(n.p,{children:"Careful mapping of topics, services, and actions is essential for efficient communication."}),"\n",(0,s.jsx)(n.h3,{id:"key-topics-and-message-types",children:"Key Topics and Message Types:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/audio/input"}),": ",(0,s.jsx)(n.code,{children:"audio_common_msgs/AudioData"})," (from microphone)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/robot/voice_command"}),": ",(0,s.jsx)(n.code,{children:"std_msgs/String"})," (text from Whisper)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/robot/action_plan"}),": ",(0,s.jsx)(n.code,{children:"std_msgs/String"})," (JSON plan from LLM Planner)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/robot/command_status"}),": ",(0,s.jsx)(n.code,{children:"std_msgs/String"})," (feedback from action mapper)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/camera/image_raw"}),": ",(0,s.jsx)(n.code,{children:"sensor_msgs/Image"})," (from cameras)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/scan"}),": ",(0,s.jsx)(n.code,{children:"sensor_msgs/LaserScan"})," (from LiDAR)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/imu/data"}),": ",(0,s.jsx)(n.code,{children:"sensor_msgs/Imu"})," (from IMU)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/object_detections"}),": ",(0,s.jsx)(n.code,{children:"vision_msgs/Detection2DArray"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/robot_pose_ekf"}),": ",(0,s.jsx)(n.code,{children:"geometry_msgs/PoseWithCovarianceStamped"})," (from sensor fusion)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/cmd_vel"}),": ",(0,s.jsx)(n.code,{children:"geometry_msgs/Twist"})," (velocity commands for base)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/joint_states"}),": ",(0,s.jsx)(n.code,{children:"sensor_msgs/JointState"})," (from robot hardware)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/robot/speech_output"}),": ",(0,s.jsx)(n.code,{children:"std_msgs/String"})," (robot's verbal response)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"key-actions-and-services",children:"Key Actions and Services:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/navigate_to_pose"}),": ",(0,s.jsx)(n.code,{children:"nav2_msgs/NavigateToPose"})," (Action for navigation)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/pick_and_place"}),": ",(0,s.jsx)(n.code,{children:"my_robot_actions/PickAndPlace"})," (Custom Action for manipulation)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"/set_joint_angles"}),": ",(0,s.jsx)(n.code,{children:"my_robot_srvs/SetJointAngles"})," (Custom Service for direct joint control)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"launch-organization",children:"Launch Organization"}),"\n",(0,s.jsx)(n.p,{children:"A well-structured set of launch files is critical for starting and managing the entire system. You'll typically have:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Top-level Launch File"}),": Orchestrates the startup of all major components."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sub-launch Files"}),": For individual subsystems (e.g., ",(0,s.jsx)(n.code,{children:"navigation.launch.py"}),", ",(0,s.jsx)(n.code,{children:"perception.launch.py"}),", ",(0,s.jsx)(n.code,{children:"hri.launch.py"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Robot Description Launch File"}),": Loads the URDF and ",(0,s.jsx)(n.code,{children:"robot_state_publisher"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"example-main-capstone-launch-file",children:"Example: Main Capstone Launch File"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"my_capstone_robot/launch/capstone_robot.launch.py"})})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import os\r\nfrom launch import LaunchDescription\r\nfrom launch.actions import IncludeLaunchDescription, DeclareLaunchArgument\r\nfrom launch.launch_description_sources import PythonLaunchDescriptionSource\r\nfrom launch.substitutions import LaunchConfiguration, PathJoinSubstitution\r\nfrom ament_index_python.packages import get_package_share_directory\r\n\r\ndef generate_launch_description():\r\n    # Declare arguments\r\n    use_sim_time = DeclareLaunchArgument('use_sim_time', default_value='true',\r\n                                         description='Use simulation (Gazebo) clock if true')\r\n    robot_model = DeclareLaunchArgument('robot_model', default_value='humanoid_v1',\r\n                                        description='Robot model to load')\r\n    \r\n    # Path to your robot description package\r\n    robot_description_pkg = get_package_share_directory('my_robot_description')\r\n    \r\n    # Launch robot description (URDF + RSP)\r\n    robot_description_launch = IncludeLaunchDescription(\r\n        PythonLaunchDescriptionSource(\r\n            os.path.join(robot_description_pkg, 'launch', 'robot_description.launch.py')\r\n        ),\r\n        launch_arguments={'robot_model': LaunchConfiguration('robot_model')}.items()\r\n    )\r\n    \r\n    # Launch Gazebo simulation\r\n    gazebo_launch = IncludeLaunchDescription(\r\n        PythonLaunchDescriptionSource(\r\n            os.path.join(get_package_share_directory('my_robot_simulation'), 'launch', 'robot_world.launch.py')\r\n        ),\r\n        launch_arguments={'use_sim_time': LaunchConfiguration('use_sim_time')}.items()\r\n    )\r\n\r\n    # Launch Nav2 stack\r\n    navigation_launch = IncludeLaunchDescription(\r\n        PythonLaunchDescriptionSource(\r\n            os.path.join(get_package_share_directory('my_robot_navigation'), 'launch', 'navigation_bringup.launch.py')\r\n        ),\r\n        launch_arguments={'use_sim_time': LaunchConfiguration('use_sim_time')}.items()\r\n    )\r\n\r\n    # Launch HRI and AI agent stack\r\n    hri_ai_launch = IncludeLaunchDescription(\r\n        PythonLaunchDescriptionSource(\r\n            os.path.join(get_package_share_directory('my_robot_hri'), 'launch', 'hri_agent_stack.launch.py')\r\n        ),\r\n        launch_arguments={'use_sim_time': LaunchConfiguration('use_sim_time')}.items()\r\n    )\r\n\r\n    return LaunchDescription([\r\n        use_sim_time,\r\n        robot_model,\r\n        robot_description_launch,\r\n        gazebo_launch,\r\n        navigation_launch,\r\n        hri_ai_launch,\r\n    ])\n"})}),"\n",(0,s.jsx)(n.h2,{id:"configuration-management",children:"Configuration Management"}),"\n",(0,s.jsx)(n.p,{children:"Effective configuration management is key for adapting the robot to different tasks or environments. This involves:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YAML Parameter Files"}),": Centralizing parameters for nodes in YAML files."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Launch Arguments"}),": Using launch arguments to easily switch between configurations (e.g., simulation vs. real robot, different robot models)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ROS 2 Params"}),": Using ",(0,s.jsx)(n.code,{children:"ros2 param"})," commands for runtime parameter inspection and modification."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"logging-and-debugging",children:"Logging and Debugging"}),"\n",(0,s.jsx)(n.p,{children:"A robust logging and debugging strategy is essential for diagnosing issues in complex robotic systems."}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"ROS 2 Logging"}),": Utilize ",(0,s.jsx)(n.code,{children:"rclpy"}),"'s logging mechanisms (",(0,s.jsx)(n.code,{children:"self.get_logger().info()"}),", ",(0,s.jsx)(n.code,{children:"warn()"}),", ",(0,s.jsx)(n.code,{children:"error()"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"rqt_console"})}),": A GUI tool for viewing ROS 2 log messages."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"rqt_graph"})}),": Visualize the ROS graph (nodes and their connections) to understand data flow."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"ros2 topic echo/info/list"})}),": Inspect topics for data content and types."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"ros2 node info/list"})}),": Inspect node status."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"testing-strategy",children:"Testing Strategy"}),"\n",(0,s.jsx)(n.p,{children:"The Capstone Project requires a comprehensive testing strategy:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Unit Testing Nodes"}),": Using ",(0,s.jsx)(n.code,{children:"pytest"})," for Python nodes or ",(0,s.jsx)(n.code,{children:"gtest"})," for C++ nodes."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Integration Testing"}),": Verify communication and functionality between interconnected nodes (e.g., voice command \u2192 navigation \u2192 motion)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Simulation Testing"}),": Thoroughly test all behaviors in Isaac Sim and Gazebo."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Hardware Testing"}),": If physical hardware is available, test critical functions on the robot."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Acceptance Testing"}),": Verify the robot meets the defined success criteria for the capstone task."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>c});var o=i(6540);const s={},r=o.createContext(s);function t(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);