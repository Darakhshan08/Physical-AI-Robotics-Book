---
id: python-packages
title: Building ROS 2 Packages with Python (rclpy)
sidebar_label: Python Packages
sidebar_position: 3
description: Python package structure, setup.py and package.xml, Entry points and console scripts, Dependencies management, Building and running.
keywords: [ros2, python, rclpy, package, setup.py, package.xml, colcon]
---

# Building ROS 2 Packages with Python (rclpy)

Developing in ROS 2 with Python is highly encouraged due to Python's ease of use and extensive ecosystem of AI/ML libraries. This chapter guides you through creating and managing ROS 2 Python packages using `rclpy`, the Python client library for ROS 2.

## Python Package Structure

A typical ROS 2 Python package structure looks like this:

```
my_python_package/
├── my_python_package/            # Python module directory (same name as package)
│   ├── __init__.py               # Makes 'my_python_package' a Python package
│   ├── my_node.py                # Your Python ROS 2 node(s)
│   └── another_utility.py        # Other Python modules/utilities
├── resource/                     # Resource files (e.g., icons, images)
├── test/                         # Unit tests
├── package.xml                   # Package metadata
├── setup.py                      # Python build configuration
├── setup.cfg                     # Python metadata for tools like `colcon`
└── CMakeLists.txt                # Required for colcon, even for pure Python packages
```

The core components for a Python package are `package.xml` and `setup.py`.

## setup.py and package.xml

-   **`package.xml`**: This file contains essential metadata about your ROS 2 package, such as its name, version, description, maintainers, license, and dependencies. It's an XML file and is crucial for ROS 2 tools like `colcon` and `rosdep`.

    ```xml
    <?xml version="1.0"?>
    <?xml-model href="http://download.ros.org/schema/package_format3.xsd" schematypens="http://www.w3.org/2001/XMLSchema"?>
    <package format="3">
      <name>my_python_package</name>
      <version>0.0.0</version>
      <description>A simple ROS 2 Python package.</description>
      <maintainer email="user@example.com">Your Name</maintainer>
      <license>Apache-2.0</license>

      <depend>rclpy</depend>
      <depend>std_msgs</depend>
      <!-- Add other message/service dependencies here -->

      <test_depend>ament_copyright</test_depend>
      <test_depend>ament_flake8</test_depend>
      <test_depend>ament_pep257</test_depend>
      <test_depend>python3-pytest</test_depend>

      <export>
        <build_type>ament_python</build_type>
      </export>
    </package>
    ```

-   **`setup.py`**: This Python script defines how your package is built and what executables (nodes, console scripts) it provides. It's used by `setuptools`, which `colcon` orchestrates.

    ```python
    from setuptools import find_packages, setup
    import os
    from glob import glob

    package_name = 'my_python_package'

    setup(
        name=package_name,
        version='0.0.0',
        packages=find_packages(exclude=['test']),
        data_files=[
            ('share/ament_index/resource_index/packages',
                ['resource/' + package_name]),
            ('share/' + package_name, ['package.xml']),
            (os.path.join('share', package_name, 'launch'), glob(os.path.join('launch', '*launch.[pxy][yeml]'))),
            # Add other data files like config, rviz etc.
        ],
        install_requires=['setuptools'],
        zip_safe=True,
        maintainer='Your Name',
        maintainer_email='user@example.com',
        description='A simple ROS 2 Python package.',
        license='Apache-2.0',
        tests_require=['pytest'],
        entry_points={
            'console_scripts': [
                'simple_publisher = my_python_package.simple_publisher:main',
                'simple_subscriber = my_python_package.simple_subscriber:main',
                'simple_service_server = my_python_package.simple_service_server:main',
                'simple_service_client = my_python_package.simple_service_client:main',
                # Add other nodes here
            ],
        },
    )
    ```

## Entry Points and Console Scripts

The `entry_points` dictionary in `setup.py` is where you define your executables.
-   `'console_scripts'` specifies command-line tools that `colcon` will make available.
-   The format is `executable_name = python_module.python_file:main_function`.

For example, `simple_publisher = my_python_package.simple_publisher:main` means that when you run `ros2 run my_python_package simple_publisher`, `colcon` will execute the `main()` function within the `simple_publisher.py` file found inside the `my_python_package` Python module.

## Dependencies Management

Dependencies are declared in `package.xml` and `setup.py`:
-   **`package.xml` (`<depend>`)**: For ROS 2 packages and message types (e.g., `rclpy`, `std_msgs`). Used by `rosdep` to install system dependencies.
-   **`setup.py` (`install_requires`)**: For standard Python packages (e.g., `setuptools`).

It's crucial to keep these in sync. Use `rosdep install --from-paths src --ignore-src -r -y` in your workspace root to install missing system dependencies.

## Building and Running

To build your Python package:

```bash
cd ~/ros2_ws
colcon build --packages-select my_python_package
```

After building, you must source your workspace to make the new executables available:

```bash
source install/setup.bash
```

Now you can run your nodes:

```bash
ros2 run my_python_package simple_publisher
ros2 run my_python_package simple_subscriber <args>
```
